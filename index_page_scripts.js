var shoeData = { "shoes": [
    {   
        "id":"shoe1",
        "name":"Pure Tone",
        "gender":"Women",
        "style":"Flat",
        "sizes":[4, 4.5, 5, 5.5, 6, 6.5, 7],
        "price":75.00,
        "colour":"Black",
        "description":"These chic snake print shoes are crafted from a combination of soft leather and nubuck. For ultimate versatility, they feature a heel piece that folds down - allowing them to be worn as slip-ons or mules. The simple yet sophisticated upper is teamed with a low 2cm heel and rubber outsole to help with grip, while a leather lining and sock work together with our dual density Cushion Plus™ technology to provide comfort in every step.",
        "quickspecs": ["Black leather upper", "Heritage stitching", "Breathable leather lining", "Flexible rubber sole", "Heel height: 25mm"],
        "picture": ["images/shoe1_0.jpg", "images/shoe1_1.jpg", "images/shoe1_2.jpg", "images/shoe1_3.jpg", "images/shoe1_4.jpg", "images/shoe1_5.jpg", "images/shoe1_6.jpg"],
        "url":"shoes/shoe1.html"
    },
    {
        "id":"shoe2",
        "name":"Orinoco 2 Lace",
        "gender":"Women",
        "style":"Boot",
        "sizes":[5, 6, 7],
        "price":89.00,
        "colour":"Brown",
        "description":"Refreshing our bestselling Orinoco profile, a lace-up ankle boot that stays all day wearable. The premium dark olive leather upper stays classic and crafted while the cleated sole with 3cm heel feels durable and adds grip. Perfect to step into the season with casual style.",
        "quickspecs": ["Upper Material: Waxy Leather", "Lining Material: Textile", "Heel Height: 3 cm", "Sole Material: TR", "Fastening Type: Lace", "Removable Insole: No", "Boot Leg Circumference: 24 cm", "Boot Leg Height: 16 cm"],
        "picture": ["images/shoe2_0.jpg", "images/shoe2_1.jpg", "images/shoe2_2.jpg", "images/shoe2_3.jpg", "images/shoe2_4.jpg", "images/shoe2_5.jpg", "images/shoe2_6.jpg"],
        "url":"shoes/shoe2.html"
    },
    {
        "id":"shoe3",
        "name":"Wave 2.0 Way",
        "gender":"Men",
        "style":"Trainer",
        "sizes":[6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11],
        "price":110.00,
        "colour":"Black",
        "description":"Innovative WaveWalk technology makes Wave 2.0 Way the perfect walking shoe, with a gently curved sole that aids natural movement and a Contoured Comfort™ footbed for all-day cushioning. Its casual aesthetic in premium black leather and recycled materials has a sporty feel and an eco-friendly focus.",
        "quickspecs": ["Upper Material: Leather", "Lining Material: Textile", "Sole Material: Rubber", "Fastening Type: Lace", "Removable Insole: No"],
        "picture": ["images/shoe3_0.jpg", "images/shoe3_1.jpg", "images/shoe3_2.jpg", "images/shoe3_3.jpg", "images/shoe3_4.jpg", "images/shoe3_5.jpg", "images/shoe3_6.jpg"],
        "url":"shoes/shoe3.html"
    },
    {
        "id":"shoe4",
        "name":"Howard Wing",
        "gender":"Men",
        "style":"Brogue",
        "sizes":[6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 12],
        "price":69.00,
        "colour":"Black",
        "description":"For a formal shoe that’s always in style, you can’t beat the classic brogue. Howard Wing in rich black leather melds a traditional finish with contemporary comfort credentials: targeted Cushion Plus™ technology, a breathable sock, padded edges and a lightweight sole. Hidden elastic offers a snug fit that’s just right, too. Eco-friendly features include a footbed, sock and laces that utilise recycled rubber and bio-based materials.",
        "quickspecs": ["Upper Material: Leather", "Lining Material: Hairsheep", "Sole Material: TR", "Fastening Type: Lace", "Removable Insole: No"],
        "picture": ["images/shoe4_0.jpg", "images/shoe4_1.jpg", "images/shoe4_2.jpg", "images/shoe4_3.jpg", "images/shoe4_4.jpg", "images/shoe4_5.jpg", "images/shoe4_6.jpg"],
        "url":"shoes/shoe4.html"
    },
    {
        "id":"shoe5",
        "name":"Home Comfort",
        "gender":"Women",
        "style":"Slipper",
        "sizes":[4, 5, 6, 7, 8],
        "price":35.00,
        "colour":"Pink",
        "description":"A classic slipper crafted for a feel-good fit, Home Comfort will soon become your next staple at-home style. An adjustable riptape fastening and durable sole keep feet confident and supported, and a velvety rose fabric upper offers a premium feel. Ideal for gifting.",
        "quickspecs": ["Upper Material: Textile", "Lining Material: Synthetic Fur", "Sole Material: Mixed", "Removable Insole: No"],
        "picture": ["images/shoe5_0.jpg", "images/shoe5_1.jpg", "images/shoe5_2.jpg", "images/shoe5_3.jpg", "images/shoe5_4.jpg", "images/shoe5_5.jpg", "images/shoe5_6.jpg"],
        "url":"shoes/shoe5.html"
    },
    {
        "id":"shoe6",
        "name":"Violet 85 Court",
        "gender":"Women",
        "style":"Heel",
        "sizes":[4, 5, 5.5, 6, 7, 8],
        "price":89.00,
        "colour":"Black",
        "description":"With sumptuous leather linings and a classic toe shape, the chic Violet 85 Court delivers style and comfort on a sleek 8.5cm contemporary heel. Crafted from responsibly sourced black leather, it’s a staple that can be effortlessly dressed up or down.",
        "quickspecs": ["Upper Material: Leather", "Lining Material: Leather", "Heel Height: 8.5 cm", "Sole Material: Resin Rubber", "Removable Insole: No"],
        "picture": ["images/shoe6_0.jpg", "images/shoe6_1.jpg", "images/shoe6_2.jpg", "images/shoe6_3.jpg", "images/shoe6_4.jpg", "images/shoe6_5.jpg", "images/shoe6_6.jpg"],
        "url":"shoes/shoe6.html"
    },
    {
        "id":"shoe7",
        "name":"Un Abode Go",
        "gender":"Men",
        "style":"Loafer",
        "sizes":[6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 12],
        "price":89.00,
        "colour":"Tan",
        "description":"This classic slip-on style from our Unstructured collection ensures unbeatable comfort with every step. The upper is teamed with a lightweight EVA and rubber sole that uses a dual density footbed and Cushion Max™ technology.",
        "quickspecs": ["Upper Material: Leather", "Lining Material: Leather", "Sole Material: Rubber", "Removable Insole: Yes"],
        "picture": ["images/shoe7_0.jpg", "images/shoe7_1.jpg", "images/shoe7_2.jpg", "images/shoe7_3.jpg", "images/shoe7_4.jpg", "images/shoe7_5.jpg", "images/shoe7_6.jpg"],
        "url":"shoes/shoe7.html"
    },
    {
        "id":"shoe8",
        "name":"Baby Atlas",
        "gender":"Baby",
        "style":"Toddler",
        "sizes":[2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5],
        "price":30.00,
        "colour":"Khaki",
        "description":"Supporting little feet on their journey of discovery, toddler trainer Tiny Cub has a super-cute fox print and is superlight, flexible, and expertly crafted to help kids develop their gait cycle naturally. The soft yet hard-wearing khaki leather upper can take on the toughest of playtimes while the durable rubber sole gives extra grip for wobbly walkers. A breathable leather footbed keeps tiny toes cool and comfortable.",
        "quickspecs": ["Upper Material: Textile", "Lining Material: Leather", "Sole Material: Leather", "Fastening Type: Riptape", "Trims: Embroidery"],
        "picture": ["images/shoe8_0.jpg", "images/shoe8_1.jpg", "images/shoe8_2.jpg", "images/shoe8_3.jpg", "images/shoe8_4.jpg", "images/shoe8_5.jpg", "images/shoe8_6.jpg"],
        "url":"shoes/shoe8.html"
    }
]}


var usp = new URLSearchParams(window.location.search);

var droppedItemList = [];
try {
    if (localStorage.getItem("droppedItemList").split(",") != "") {
        droppedItemList = localStorage.getItem("droppedItemList").split(",")
    }
} catch(ex) {localStorage.setItem("droppedItemList", []);}
addDroppedItemsListToDoc();
window.addEventListener("storage", addDroppedItemsListToDoc);

$(document).ready(function() {

    var genderList = getGenderList();
    var genderFilterHtml = ``;
    for(var i in genderList) {
        genderFilterHtml += `
            <input type="radio" name="gender" id="${genderList[i].toLowerCase()}" value="${genderList[i]}">
            <label for="${genderList[i].toLowerCase()}">${genderList[i]}</label>
        `;
    };
    document.getElementById("gender_filter").innerHTML = genderFilterHtml;

    var styleList = getStyleList();
    var styleFilterHtml = ``;
    for(var i in styleList) {
        styleFilterHtml += `
            <input type="radio" name="style" id="${styleList[i].toLowerCase()}" value="${styleList[i]}">
            <label for="${styleList[i].toLowerCase()}">${styleList[i]}</label>
        `;
    };
    document.getElementById("style_filter").innerHTML = styleFilterHtml;

    var colorList = getColorList();
    var colorFilterHtml = ``;
    for(var i in colorList) {
        colorFilterHtml += `
            <input type="radio" name="color" id="${colorList[i].toLowerCase()}" value="${colorList[i]}">
            <label for="${colorList[i].toLowerCase()}">${colorList[i]}</label>
        `;
    };
    document.getElementById("color_filter").innerHTML = colorFilterHtml;

    var sizeList = getSizeList();
    var sizeFilterHtml = ``;
    for(var i in sizeList) {
        sizeFilterHtml += `
            <input type="radio" name="size" id="size_${String(sizeList[i]).split(".").join("_")}" value="${sizeList[i]}">
            <label for="size_${String(sizeList[i]).split(".").join("_")}" class="size_lbl">${sizeList[i]}</label>
        `;
    };
    document.getElementById("size_filter").innerHTML = sizeFilterHtml;

    minMaxDuo = getMinMaxPrice();
    $("#minPricesLbl").html(minMaxDuo[0]);
    $("#maxPricesLbl").html(minMaxDuo[1]);

    $(function() {
        $("#price_slider").slider({
            min: minMaxDuo[0],
            max: minMaxDuo[1],
            step: 1,
            values: [minMaxDuo[0], minMaxDuo[1]],
            slide: function(event, ui) {
                $("#minPricesLbl").html(ui.values[0]);
                $("#maxPricesLbl").html(ui.values[1]);
            }
        });
    });
    $( function() {
        $( "#shoe_filter_accordion" ).accordion({
            heightStyle: "content",
            icons: false
        });
    });

    $( function() {
        $( ".cartWishListSection" ).tabs(); 
    } );

    loadShoes();

    $( ".searchResult").draggable({
        helper: "clone",
        zIndex: 1,
        containment: "html",
        start: function(e, ui) { 
            $(ui.helper).css("transition", "none");
        }
    }); 

    $("#savedItems").droppable({
        drop:function(e, ui) {
            var droppedItemId = ui.draggable.attr("id");
            if(!droppedItemList.includes(droppedItemId)) {
                droppedItemList.push(droppedItemId);

                try {
                    localStorage.setItem("droppedItemList", droppedItemList);
                } catch(e) {
                    console.log("Error!");
                }

                addDroppedItemsListToDoc();
            } 
        }
    });

    $("#search_btn").on("click", function() {

        var searchObj = {};

        var genderSelection = $("input[name='gender']:checked").val();
        var styleSelection = $("input[name='style']:checked").val();
        var colorSelection = $("input[name='color']:checked").val();
        var sizeSelection = $("input[name='size']:checked").val();
        var minPriceSelection = $("#minPricesLbl").html();
        var maxPriceSelection = $("#maxPricesLbl").html();

        if(genderSelection != null) {
            searchObj["gender"] = genderSelection.toLowerCase();
        }
        if(styleSelection != null) {
            searchObj["style"] = styleSelection.toLowerCase();
        }
        if(colorSelection != null) {
            searchObj["colour"] = colorSelection.toLowerCase();
        }
        if(sizeSelection != null) {
            searchObj["size"] = sizeSelection;
        }
        if(minPriceSelection != null) {
            searchObj["minprice"] = minPriceSelection;
        }
        if(maxPriceSelection != null) {
            searchObj["maxprice"] = maxPriceSelection;
        }

        window.location.href = `?${new URLSearchParams(searchObj).toString()}`;

    });

    $(document).on("click", ".savedItemRemoveBtn", function(e) {
        
        var savedItemRemoveBtn_ShoeId = e.target.id.split("_")[0];
        savedItemRemove(savedItemRemoveBtn_ShoeId);
    });
    $(document).on("click", ".addToSaveListBtn", function(e) {
        var addToSaveListBtn_ShoeId = e.target.id.split("_")[0];
        if(!droppedItemList.includes(addToSaveListBtn_ShoeId)) {
            droppedItemList.push(addToSaveListBtn_ShoeId);

            try {
                localStorage.setItem("droppedItemList", droppedItemList);
            } catch(ex) {}
            addDroppedItemsListToDoc(); 
        }
    });

});

function loadShoes() {
    
    var shoeResults = ``;
    var genderSelection = usp.get("gender");
    var styleSelection = usp.get("style");
    var colorSelection = usp.get("colour");
    var sizeSelection = usp.get("size");
    var minPriceSelection = usp.get("minprice");
    var maxPriceSelection = usp.get("maxprice");
    
    for(var i in shoeData.shoes) {
        if(genderSelection == shoeData.shoes[i].gender.toLowerCase() || genderSelection == null) {
            if(styleSelection==shoeData.shoes[i].style.toLowerCase() || styleSelection==null) {
                if(colorSelection==shoeData.shoes[i].colour.toLowerCase() || colorSelection==null) {
                    if(shoeData.shoes[i].sizes.includes(parseInt(sizeSelection)) || sizeSelection==null) {
                        if(minPriceSelection <= shoeData.shoes[i].price || minPriceSelection == null) {
                            if(maxPriceSelection >= shoeData.shoes[i].price || maxPriceSelection == null) {
                                shoeResults += `
                                    <div class="searchResult" style="border-left: ${shoeData.shoes[i].colour} 3px solid;" id="${shoeData.shoes[i].id}">
                                        <a href="shoe.html?id=${shoeData.shoes[i].id}" class="searchResultAnchor" target="_blank">
                                        <div class="searchResultContent">
                                            <img src="${shoeData.shoes[i].picture[0]}" alt="Image not avaiilable.">
                                            <div class="searchResultDescriptionBox">
                                                <div>
                                                    <span class="searchResultName"><b>${shoeData.shoes[i].name}</b></span><br>
                                                    <span class="searchResultDescrips">${shoeData.shoes[i].style}</span><br>
                                                    <span class="searchResultDescrips">${shoeData.shoes[i].colour}</span>
                                                </div>
                                                <div class="searchResultPriceBox">
                                                    <span class="searchResultDescrips">${shoeData.shoes[i].price}</span>
                                                </div>
                                            </div>
                                        </div>
                                        </a>
                                        <div class="searchResultCartWishListWrap">
                                            <button class="addToSaveListBtn" id="${shoeData.shoes[i].id}_AddToSavedItemsBtn">
                                            <button class="addToCartBtn" id="${shoeData.shoes[i].id}_AddToCartBtn">
                                        </div>
                                    </div>
                                `;
                            }
                        }
                                
                    }
                }
            }
        }  
    }
    
    document.getElementById("searchResultCards").innerHTML = shoeResults;
}

function getGenderList() {
    var genderList = [];
    for(var i in shoeData.shoes) {
        if(!genderList.includes(shoeData.shoes[i].gender)) {
            genderList.push(shoeData.shoes[i].gender);
        }
    }
    return genderList.sort();
}

function getStyleList() {
    var styleList = [];
    for(var i in shoeData.shoes) {
        if(!styleList.includes(shoeData.shoes[i].style)) {
            styleList.push(shoeData.shoes[i].style);
        }
    }
    return styleList.sort();
}

function getColorList() {
    var colorList = [];
    for(var i in shoeData.shoes) {
        if(!colorList.includes(shoeData.shoes[i].colour)) {
            colorList.push(shoeData.shoes[i].colour);
        }
    }
    return colorList.sort();
}

function getSizeList() {
    var sizeList = [];
    for(var i in shoeData.shoes) {
        for(var j in shoeData.shoes[i].sizes) {
            if(!sizeList.includes(shoeData.shoes[i].sizes[j])) {
                sizeList.push(shoeData.shoes[i].sizes[j]);
            }
        }
    }
    return sizeList.sort(function(a, b) {
        return parseInt(a) - parseInt(b);
    });
}

function getMinMaxPrice() {
    var minMaxDuo = [shoeData.shoes[0].price, shoeData.shoes[0].price];

    for(var i in shoeData.shoes) {
        if(shoeData.shoes[i].price < minMaxDuo[0]) {
            minMaxDuo[0] = shoeData.shoes[i].price;
        } 
        if(shoeData.shoes[i].price > minMaxDuo[1]) {
            minMaxDuo[1] = shoeData.shoes[i].price;
        }
    }
    return minMaxDuo;
}

function getShoeArrayIndexById(shoeId) {
    for (var i = 0; i < shoeData.shoes.length; i++) {
        if (shoeData.shoes[i].id == shoeId) {
            return i;
        }
    }
    return null;
}

function addDroppedItemsListToDoc() {
    try {
        if (localStorage.getItem("droppedItemList").split(",") != "") {
            droppedItemList = localStorage.getItem("droppedItemList").split(",");
        }
    } catch(ex) {}
    var savedItemHtml = ``;
    for (var i=0; i<droppedItemList.length; i++) {
        var droppedShoe = shoeData.shoes[getShoeArrayIndexById(droppedItemList[i])];
        
        savedItemHtml += `
            <div class="savedItem">
                <div class="savedItemContent">
                    <img src="${droppedShoe.picture[0]}" alt="Not found!">
                    <div class="savedItemDescrips">
                        <span class="savedItemName">${droppedShoe.name}</span><br>
                        <span>${droppedShoe.colour}</span><br>
                        <span class="savedItemPrice">${droppedShoe.price}</span><br>
                    </div>
                </div>
                <div class="savedItemContentWrapper"></div>
                <a href="shoe.html?id=${droppedShoe.id}" target="_blank"><img src="images/icons/open_in_new_white.svg" alt="Image not avaiilable." id="CartWishListItempenInNewWindowImg"></a>
                <button class="savedItemRemoveBtn" id="${droppedShoe.id}_savedItemRemoveBtn">X</button>
            </div>
        `;
    }

    document.getElementById("savedItems").innerHTML = savedItemHtml;
}

function savedItemRemove(savedItemRemoveBtn_ShoeId) {
    droppedItemList.splice(droppedItemList.indexOf(savedItemRemoveBtn_ShoeId), 1);
    try {
        localStorage.setItem("droppedItemList", droppedItemList);
    } catch(ex) {}
    addDroppedItemsListToDoc();
}

function myTestFunc(e) {
    alert("updated from to by outside!");
}
